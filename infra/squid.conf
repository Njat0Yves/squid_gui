###############################################################
#                     SQUID CONFIGURATION                     #
#         Version adaptée pour projet Proxy + GUI Python      #
###############################################################

# ============================
# 1. PORT D'ÉCOUTE
# ============================
http_port 3128


# ============================
# 2. FICHIERS INCLUS
# ============================
# (ne rien toucher ici)
include /etc/squid/conf.d/*.conf


# ============================
# 3. AUTHENTIFICATION
# ============================
# Utilise le fichier /etc/squid/passwords (géré par ton GUI)
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwords
auth_param basic realm "Squid Proxy Authentication"
auth_param basic children 20 startup=5 idle=1
auth_param basic credentialsttl 8 hours
auth_param basic casesensitive on

# ACL : utilisateur authentifié
acl authenticated_users proxy_auth REQUIRED


# ============================
# 4. BLOCKLIST GLOBALE
# ============================
# Liste globale des sites bloqués
acl sites_interdits_global dstdomain "/etc/squid/blocklist_global.txt"
http_access deny sites_interdits_global


# ============================
# 5. RÈGLES PAR UTILISATEUR
# ============================
# Le GUI gère automatiquement les fichiers :
# /etc/squid/users_rules/<user>.txt
#
# Exemple généré automatiquement :
# acl yves proxy_auth yves
# acl yves_sites dstdomain "/etc/squid/users_rules/yves.txt"
# http_access deny yves yves_sites
#
# Pour que Squid lise ces règles, on inclut :
include /etc/squid/users_rules/*.conf


# ============================
# 6. AUTORISATION DES UTILISATEURS
# ============================
# Après les blocklists globales + les blocklists par utilisateur :
http_access allow authenticated_users


# ============================
# 7. DENY EVERYTHING ELSE
# ============================
http_access deny all


# ============================
# 8. LOGGING
# ============================
# Fichier de logs (nécessaire pour ton GUI)
access_log stdio:/var/log/squid/access.log
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log


# ============================
# 9. PARAMÈTRES PAR DÉFAUT
# ============================
coredump_dir /var/spool/squid


###############################################################
#                        FIN DU FICHIER                       #
###############################################################
