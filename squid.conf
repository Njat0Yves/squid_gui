#############################################################
#                    SQUID CONFIGURATION                    #
#            Version stable pour Proxy + GUI Python         #
#############################################################

# ===========================================================
# 1. Port du proxy
# ===========================================================
http_port 3128


# ===========================================================
# 2. Authentification
# ===========================================================
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwords
auth_param basic realm "Squid Proxy Authentication"
auth_param basic children 20 startup=5 idle=1
auth_param basic credentialsttl 8 hours
auth_param basic casesensitive on

acl authenticated_users proxy_auth REQUIRED


# ===========================================================
# 3. Blocklist globale
# ===========================================================
acl sites_interdits_global dstdomain "/etc/squid/blocklist_global.txt"
http_access deny sites_interdits_global


# ===========================================================
# 4. Règles par utilisateur (gérées par ton GUI)
# ===========================================================
# Note: /etc/squid/users_rules/*.conf est inclus ; l'app GUI
# doit s'assurer de ne créer .conf QUE si le .txt correspondant
# contient au moins une règle (sinon pas de .conf).
include /etc/squid/users_rules/*.conf


# ===========================================================
# 5. Autorisation des utilisateurs (si pas bloqués avant)
# ===========================================================
http_access allow authenticated_users


# ===========================================================
# 6. Bloquer tout le reste
# ===========================================================
http_access deny all


# ===========================================================
# 7. Logs
# ===========================================================
access_log stdio:/var/log/squid/access.log
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log


# ===========================================================
# 8. Répertoire du cache
# ===========================================================
coredump_dir /var/spool/squid


#############################################################
#                      FIN DU FICHIER                       #
#############################################################
